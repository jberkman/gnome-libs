Index: .cvsignore
===================================================================
RCS file: /cvs/gnome/oaf/.cvsignore,v
retrieving revision 1.7
diff -u -u -p -r1.7 .cvsignore
--- .cvsignore	2000/06/19 16:08:10	1.7
+++ .cvsignore	2000/11/22 13:35:10
@@ -23,3 +23,4 @@ obj
 po
 stamp-h
 stamp-h.in
+oaf-2.0.pc
Index: ChangeLog
===================================================================
RCS file: /cvs/gnome/oaf/ChangeLog,v
retrieving revision 1.126
diff -u -u -p -r1.126 ChangeLog
--- ChangeLog	2000/11/16 23:08:07	1.126
+++ ChangeLog	2000/11/22 13:35:12
@@ -1,3 +1,12 @@
+2000-11-22  Martin Baulig  <martin@home-of-linux.org>
+
+	* autogen.sh: Use gnome-common with the GNOME 2 macros.
+
+	* configure.in: Use GNOME_PKGCONFIG_CHECK_MODULES to check for
+	GLib 1.3.x, ORBit and libxml2. Use AM_GNOME2_GETTEXT instead of
+	AM_GNU_OAF_GETTEXT. Call GNOME_PLATFORM_GNOME_2(yes, force). Use
+	GNOME_GTKDOC_CHECK to check for gtk-doc.
+
 2000-11-16  Elliot Lee  <sopwith@redhat.com>
 
 	* (oaf_server_by_forking) Use $OAF_OD_IOR environment variable
Index: Makefile.am
===================================================================
RCS file: /cvs/gnome/oaf/Makefile.am,v
retrieving revision 1.12
diff -u -u -p -r1.12 Makefile.am
--- Makefile.am	2000/08/10 21:55:58	1.12
+++ Makefile.am	2000/11/22 13:35:12
@@ -28,6 +28,7 @@ EXTRA_DIST=			\
 	ChangeLog 		\
 	NEWS 			\
 	README			\
+	oaf.pc.in
 	$(NULL)
 
 oafconfigdir=$(sysconfdir)/oaf
@@ -41,6 +42,9 @@ confexec_DATA = oafConf.sh
 
 m4datadir=$(datadir)/aclocal
 m4data_DATA=oaf.m4
+
+pkgconfigdir = $(libdir)/pkgconfig
+pkgconfig_DATA = oaf-2.0.pc
 
 #dist-hook: oaf.spec
 #	cp oaf.spec $(distdir)
Index: autogen.sh
===================================================================
RCS file: /cvs/gnome/oaf/autogen.sh,v
retrieving revision 1.3
diff -u -u -p -r1.3 autogen.sh
--- autogen.sh	2000/08/31 09:23:39	1.3
+++ autogen.sh	2000/11/22 13:35:12
@@ -4,77 +4,12 @@
 srcdir=`dirname $0`
 test -z "$srcdir" && srcdir=.
 
-ORIGDIR=`pwd`
-cd $srcdir
+PKG_NAME="oaf"
 
-PROJECT=oaf
-TEST_TYPE=-f
-FILE=idl/oaf.idl
-
-DIE=0
-
-(autoconf --version) < /dev/null > /dev/null 2>&1 || {
-	echo
-	echo "You must have autoconf installed to compile $PROJECT."
-	echo "Download the appropriate package for your distribution,"
-	echo "or get the source tarball at ftp://ftp.gnu.org/pub/gnu/"
-	DIE=1
-}
-
-(libtool --version) < /dev/null > /dev/null 2>&1 || {
-	echo
-	echo "You must have libtool installed to compile $PROJECT."
-	echo "Get ftp://alpha.gnu.org/gnu/libtool-1.0h.tar.gz"
-	echo "(or a newer version if it is available)"
-	DIE=1
-}
-
-(automake --version) < /dev/null > /dev/null 2>&1 || {
-	echo
-	echo "You must have automake installed to compile $PROJECT."
-	echo "Get ftp://ftp.cygnus.com/pub/home/tromey/automake-1.2d.tar.gz"
-	echo "(or a newer version if it is available)"
-	DIE=1
-}
-
-if test "$DIE" -eq 1; then
-	exit 1
-fi
-
-test $TEST_TYPE $FILE || {
-	echo "You must run this script in the top-level $PROJECT directory"
+(test -f idl/oaf.idl) || {
+	echo "You must run this script in the top-level oaf directory"
 	exit 1
 }
-
-if test -z "$*"; then
-	echo "I am going to run ./configure with no arguments - if you wish "
-        echo "to pass any to it, please specify them on the $0 command line."
-fi
-
-case $CC in
-*lcc | *lcc\ *) am_opt=--include-deps;;
-esac
-
-echo "Running gettextize...  Ignore non-fatal messages."
-# Hmm, we specify --force here, since otherwise things don't
-# get added reliably, but we don't want to overwrite intl
-# while making dist.
-echo "no" | gettextize --copy --force
-
-echo "Running libtoolize"
-libtoolize --copy --force
-
-aclocal $ACLOCAL_FLAGS
-
-# optionally feature autoheader
-(autoheader --version)  < /dev/null > /dev/null 2>&1 && autoheader
-
-automake -a $am_opt
-autoconf
-
-cd $ORIGDIR
 
-$srcdir/configure --enable-maintainer-mode "$@"
+USE_GNOME2_MACROS=1 . gnome-autogen.sh
 
-echo 
-echo "Now type 'make' to compile $PROJECT."
Index: configure.in
===================================================================
RCS file: /cvs/gnome/oaf/configure.in,v
retrieving revision 1.49
diff -u -u -p -r1.49 configure.in
--- configure.in	2000/11/12 15:49:08	1.49
+++ configure.in	2000/11/22 13:35:12
@@ -34,75 +34,30 @@ AC_ISC_POSIX
 
 dnl internationalization support
 ALL_LINGUAS="da de es fi fr ga gl hu it ja ko no ru sl sv tr uk pl"
-AM_GNU_OAF_GETTEXT
+AM_GNOME2_GETTEXT
 
+GNOME_COMMON_INIT
+GNOME_PLATFORM_GNOME_2(yes, force)
 
 dnl Checks for libraries.
-AM_PATH_GLIB(1.2.0,,
-AC_MSG_ERROR([
-*** GLIB 1.2.0 or better is required. The latest version of GLIB
-*** is always available from ftp://ftp.gtk.org/.]), gmodule)
-
-AM_PATH_ORBIT(0.5.1,,AC_MSG_ERROR([ORBit not installed or installation problem]))
+GNOME_PKGCONFIG_CHECK_MODULES(GLIB, gmodule-2.0:1.3.1)
+AC_SUBST(GLIB_LIBS)
+AC_SUBST(GLIB_CFLAGS)
+
+GNOME_PKGCONFIG_CHECK_MODULES(ORBIT, ORBit-2.0:0.5.3)
+AC_SUBST(ORBIT_LIBS)
+AC_SUBST(ORBIT_CFLAGS)
+AC_PATH_PROG(ORBIT_IDL, orbit-idl)
 AC_DEFINE(HAVE_ORB_ORBIT_H)
 
-dnl Check for ORBit > 0.5.1 (CORBA_Object_create_request is prototyped
-dnl in orb/dii.h in the "new" ORBit, but not ORBit 0.5.1, so #defining
-dnl it to nothing results in a compile error iff we have the new ORBit.)
-saved_CFLAGS="$CFLAGS"
-saved_LDFLAGS="$LDFLAGS"
-CFLAGS="$CFLAGS $ORBIT_CFLAGS"
-LDFLAGS="$LDFLAGS $ORBIT_LDFLAGS"
-AC_TRY_COMPILE([
-#define CORBA_Object_create_request
-#include <orb/dii.h>
-],[], AC_MSG_ERROR([You need a newer version of ORBit. See the README.]), :)
-CFLAGS="$saved_CFLAGS"
-LDFLAGS="$saved_LDFLAGS"
-
-APP_LIBS=""
-AC_SUBST(APP_LIBS)
-
-dnl	
-dnl Locate the xml library
-dnl
-AC_CHECK_PROG(XML_CONFIG, xml-config, xml-config)
-if test "$XML_CONFIG" != "" 
-then
-  XML_LIBS="`$XML_CONFIG --libs`"
-  XML_CFLAGS="`$XML_CONFIG --cflags`"
-else
-  AC_MSG_ERROR(Can't find gnome-xml library.)
-fi
+GNOME_PKGCONFIG_CHECK_MODULES(XML, libxml-2.0:2.2.8)
 AC_SUBST(XML_LIBS)
 AC_SUBST(XML_CFLAGS)
 
 dnl ======================
 dnl = gtk-doc stuff
 dnl ======================
-
-AC_CHECK_PROG(GTKDOC, gtkdoc-mkdb, true, false)
-AM_CONDITIONAL(HAVE_GTK_DOC, $GTKDOC)
-AC_SUBST(HAVE_GTK_DOC)
-
-dnl Let people disable the gtk-doc stuff.
-AC_ARG_ENABLE(gtk-doc, [  --enable-gtk-doc  Use gtk-doc to build documentation [default=auto]], enable_gtk_doc="$enableval", enable_gtk_doc=auto)
-
-if test x$enable_gtk_doc = xauto ; then
-  if test x$GTKDOC = xtrue ; then
-    enable_gtk_doc=yes
-  else
-    enable_gtk_doc=no
-  fi
-fi
-dnl NOTE: We need to use a separate automake conditional for this
-dnl       to make this work with the tarballs.
-AM_CONDITIONAL(ENABLE_GTK_DOC, test x$enable_gtk_doc = xyes)
-
-dnl ======================
-dnl = end gtk-doc stuff
-dnl ======================
-
+GNOME_GTKDOC_CHECK
 
 AC_CHECK_LIB(popt, poptGetContext,,
 AC_MSG_ERROR([You must have popt installed. Get it from ftp://ftp.redhat.com/pub/redhat/code/popt/]))
@@ -184,5 +139,6 @@ intl/Makefile
 po/Makefile.in
 oaf-config
 oafConf.sh
+oaf-2.0.pc
 ],
 [sed -e "/POTFILES =/r po/POTFILES" po/Makefile.in > po/Makefile])
Index: oaf-2.0.pc.in
===================================================================
RCS file: oaf-2.0.pc.in
diff -N oaf-2.0.pc.in
--- /dev/null	Tue May  5 16:32:27 1998
+++ oaf-2.0.pc.in	Wed Nov 22 08:35:12 2000
@@ -0,0 +1,11 @@
+prefix=@prefix@
+exec_prefix=@exec_prefix@
+libdir=@libdir@
+includedir=@includedir@
+
+
+Name: OAF
+Description: Object activation framework for GNOME
+Requires: ORBit-2.0
+Libs: -L${libdir} -loaf
+Cflags: -I${includedir}
\ No newline at end of file
Index: po/Makefile.in.in
===================================================================
RCS file: /cvs/gnome/oaf/po/Makefile.in.in,v
retrieving revision 1.4
diff -u -u -p -r1.4 Makefile.in.in
--- po/Makefile.in.in	2000/11/16 23:08:09	1.4
+++ po/Makefile.in.in	2000/11/22 13:35:13
@@ -24,8 +24,6 @@ gnulocaledir = $(prefix)/share/locale
 gettextsrcdir = $(prefix)/share/gettext/po
 subdir = po
 
-DESTDIR =
-
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 MKINSTALLDIRS = $(top_srcdir)/@MKINSTALLDIRS@
@@ -113,16 +111,16 @@ install-data: install-data-@USE_NLS@
 install-data-no: all
 install-data-yes: all
 	if test -r "$(MKINSTALLDIRS)"; then \
-	  $(MKINSTALLDIRS) $(DESTDIR)$(datadir); \
+	  $(MKINSTALLDIRS) $(datadir); \
 	else \
-	  $(SHELL) $(top_srcdir)/mkinstalldirs $(DESTDIR)$(datadir); \
+	  $(SHELL) $(top_srcdir)/mkinstalldirs $(datadir); \
 	fi
 	@catalogs='$(CATALOGS)'; \
 	for cat in $$catalogs; do \
 	  cat=`basename $$cat`; \
 	  case "$$cat" in \
-	    *.gmo) destdir=$(DESTDIR)$(gnulocaledir);; \
-	    *)     destdir=$(DESTDIR)$(localedir);; \
+	    *.gmo) destdir=$(gnulocaledir);; \
+	    *)     destdir=$(localedir);; \
 	  esac; \
 	  lang=`echo $$cat | sed 's/\$(CATOBJEXT)$$//'`; \
 	  dir=$$destdir/$$lang/LC_MESSAGES; \
@@ -155,12 +153,12 @@ install-data-yes: all
 	done
 	if test "$(PACKAGE)" = "gettext"; then \
 	  if test -r "$(MKINSTALLDIRS)"; then \
-	    $(MKINSTALLDIRS) $(DESTDIR)$(gettextsrcdir); \
+	    $(MKINSTALLDIRS) $(gettextsrcdir); \
 	  else \
-	    $(SHELL) $(top_srcdir)/mkinstalldirs $(DESTDIR)$(gettextsrcdir); \
+	    $(SHELL) $(top_srcdir)/mkinstalldirs $(gettextsrcdir); \
 	  fi; \
 	  $(INSTALL_DATA) $(srcdir)/Makefile.in.in \
-			  $(DESTDIR)$(gettextsrcdir)/Makefile.in.in; \
+			  $(gettextsrcdir)/Makefile.in.in; \
 	else \
 	  : ; \
 	fi
@@ -173,12 +171,12 @@ uninstall:
 	for cat in $$catalogs; do \
 	  cat=`basename $$cat`; \
 	  lang=`echo $$cat | sed 's/\$(CATOBJEXT)$$//'`; \
-	  rm -f $(DESTDIR)$(localedir)/$$lang/LC_MESSAGES/$(PACKAGE)$(INSTOBJEXT); \
-	  rm -f $(DESTDIR)$(localedir)/$$lang/LC_MESSAGES/$(PACKAGE)$(INSTOBJEXT).m; \
-	  rm -f $(DESTDIR)$(gnulocaledir)/$$lang/LC_MESSAGES/$(PACKAGE)$(INSTOBJEXT); \
-	  rm -f $(DESTDIR)$(gnulocaledir)/$$lang/LC_MESSAGES/$(PACKAGE)$(INSTOBJEXT).m; \
+	  rm -f $(localedir)/$$lang/LC_MESSAGES/$(PACKAGE)$(INSTOBJEXT); \
+	  rm -f $(localedir)/$$lang/LC_MESSAGES/$(PACKAGE)$(INSTOBJEXT).m; \
+	  rm -f $(gnulocaledir)/$$lang/LC_MESSAGES/$(PACKAGE)$(INSTOBJEXT); \
+	  rm -f $(gnulocaledir)/$$lang/LC_MESSAGES/$(PACKAGE)$(INSTOBJEXT).m; \
 	done
-	rm -f $(DESTDIR)$(gettextsrcdir)/po-Makefile.in.in
+	rm -f $(gettextsrcdir)/po-Makefile.in.in
 
 check: all
 
